<!DOCTYPE html>
{% load static %}
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="{% static 'css/course_detail.css' %}" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" />
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;900&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.62.2/codemirror.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.62.2/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.62.2/mode/javascript/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.62.2/mode/python/python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.62.2/mode/clike/clike.min.js"></script>
    <title>InfinityCode</title>
</head>
<body>
    <div class="container">
        <div class="header" style="background-image: url('{% static 'img/login/figure_blure.png' %}')">
            <a href="{% url 'index' %}" class="logo">INFINITY CODE</a>
            <nav>
                <ul>
                    <li><a href="{% url 'catalog' %}"><i class="fas fa-book"></i> –ö–∞—Ç–∞–ª–æ–≥</a></li>
                    {% if user.is_authenticated %}
                    <li>
                        <a href="#"><i class="fas fa-bars"></i> –ú–µ–Ω—é</a>
                        <ul>
                            <li><a href="{% url 'users:profile' %}"><i class="fas fa-user"></i> –ü—Ä–æ—Ñ–∏–ª—å</a></li>
                            {% if user.is_superuser %}
                            <li><a href="{% url 'admin:index' %}"><i class="fas fa-cogs"></i> –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</a></li>
                            {% endif %}
                            <li><a href="{% url 'users:logout' %}"><i class="fas fa-sign-out-alt"></i> –í—ã–π—Ç–∏</a></li>
                        </ul>
                    </li>
                    {% endif %}
                    {% if not user.is_authenticated %}
                    <li><a href="{% url 'users:login' %}"><i class="fas fa-sign-in-alt"></i> –í–æ–π—Ç–∏</a></li>
                    {% endif %}
                </ul>
            </nav>
        </div>
        <div class="main-content">
            <aside class="sidebar">
                <ul>
                    {% for theory in theories %}
                        <li>
                            <a href="#section{{ forloop.counter }}">{{ theory.title }}</a>
                            <ul>
                                {% for task in theory.tasks.all %}
                                    <li><a href="#task_{{ course.id }}_{{ task.id }}">{{ task.difficulty }}</a></li>
                                {% endfor %}
                            </ul>
                        </li>
                    {% endfor %}
                </ul>
            </aside>
            <div class="main">
                <div class="title">
                    <img src="{{ course.image.url }}" alt="{{ course.name }}" />
                    <p class="description">
                        –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –Ω–∞ –∫—É—Ä—Å "{{ course.name }}"!
                        –≠—Ç–æ—Ç –∫—É—Ä—Å —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ –¥–ª—è –º–æ–ª–æ–¥—ã—Ö –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ
                        —Ö–æ—Ç—è—Ç –Ω–∞—É—á–∏—Ç—å—Å—è –∫–æ–¥–∏—Ç—å –∏ —Å–æ–∑–¥–∞–≤–∞—Ç—å —Å–≤–æ–∏ –ø–µ—Ä–≤—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–∞ –æ–¥–Ω–æ–º
                        –∏–∑ —Å–∞–º—ã—Ö –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö —è–∑—ã–∫–æ–≤ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –º–∏—Ä–µ. –ú—ã –ø–æ—Å—Ç–∞—Ä–∞–ª–∏—Å—å
                        —Å–¥–µ–ª–∞—Ç—å –∫—É—Ä—Å –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–º, –¥–æ—Å—Ç—É–ø–Ω—ã–º –∏ –≤–µ—Å–µ–ª—ã–º, —á—Ç–æ–±—ã –∫–∞–∂–¥—ã–π —Ä–µ–±–µ–Ω–æ–∫
                        –º–æ–≥ —Å –ª–µ–≥–∫–æ—Å—Ç—å—é –æ—Å–≤–æ–∏—Ç—å –æ—Å–Ω–æ–≤—ã –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –ø–æ–ª—é–±–∏—Ç—å —ç—Ç–æ—Ç
                        —É–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å.
                    </p>
                </div>
                <div class="learn">
                    <div class="block for-whom">
                        <h3>–î–ª—è –∫–æ–≥–æ —ç—Ç–æ—Ç –∫—É—Ä—Å?</h3>
                        <ul class="styled-list">
                            <li>
                                üë¶üëß –î–µ—Ç–∏ –∏ –ø–æ–¥—Ä–æ—Å—Ç–∫–∏ –≤ –≤–æ–∑—Ä–∞—Å—Ç–µ –æ—Ç 8 –¥–æ 14 –ª–µ—Ç, –∫–æ—Ç–æ—Ä—ã–µ —Ö–æ—Ç—è—Ç
                                –Ω–∞—É—á–∏—Ç—å—Å—è –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞—Ç—å.
                            </li>
                            <li>
                                üå± –ù–æ–≤–∏—á–∫–∏ –≤ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–∏: –¢–µ, –∫—Ç–æ —Ä–∞–Ω–µ–µ –Ω–µ –∏–º–µ–ª –æ–ø—ã—Ç–∞
                                –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —Ö–æ—á–µ—Ç –Ω–∞—á–∞—Ç—å —Å –ø—Ä–æ—Å—Ç–æ–≥–æ –∏ –ø–æ–Ω—è—Ç–Ω–æ–≥–æ —è–∑—ã–∫–∞.
                            </li>
                            <li>
                                üöÄ –Æ–Ω—ã–µ –∏–∑–æ–±—Ä–µ—Ç–∞—Ç–µ–ª–∏: –¢–µ, –∫—Ç–æ –ª—é–±–∏—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å —á—Ç–æ-—Ç–æ –Ω–æ–≤–æ–µ –∏
                                —Ö–æ—á–µ—Ç —É–∑–Ω–∞—Ç—å, –∫–∞–∫ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ–º–ø—å—é—Ç–µ—Ä–Ω—ã–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã –∏ –∏–≥—Ä—ã.
                            </li>
                        </ul>
                    </div>
                    <div class="block advantages">
                        <h3>–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∫—É—Ä—Å–∞:</h3>
                        <ul class="styled-list">
                            <li>
                                üéÆ –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ: –ó–∞–Ω—è—Ç–∏—è –≤–∫–ª—é—á–∞—é—Ç –≤ —Å–µ–±—è –º–Ω–æ–≥–æ
                                –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏—Ö —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π –∏ –∏–≥—Ä, –∫–æ—Ç–æ—Ä—ã–µ –¥–µ–ª–∞—é—Ç –æ–±—É—á–µ–Ω–∏–µ –≤–µ—Å–µ–ª—ã–º
                                –∏ –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–º.
                            </li>
                            <li>
                                üìò –ü–æ—à–∞–≥–æ–≤—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏: –í—Å–µ —É—Ä–æ–∫–∏ —Ä–∞–∑–±–∏—Ç—ã –Ω–∞ –ø—Ä–æ—Å—Ç—ã–µ —à–∞–≥–∏,
                                –∫–æ—Ç–æ—Ä—ã–µ –ª–µ–≥–∫–æ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å.
                            </li>
                            <li>
                                üé® –¢–≤–æ—Ä—á–µ—Å–∫–∏–π –ø–æ–¥—Ö–æ–¥: –î–µ—Ç–∏ —É—á–∞—Ç—Å—è —Å–æ–∑–¥–∞–≤–∞—Ç—å —Å–≤–æ–∏ –ø—Ä–æ–µ–∫—Ç—ã –∏
                                —Ä–∞–∑–≤–∏–≤–∞—Ç—å —Å–≤–æ–∏ –∏–¥–µ–∏.
                            </li>
                            <li>
                                üë©‚Äçüè´ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∏ –Ω–∞—Å—Ç–∞–≤–Ω–∏—á–µ—Å—Ç–≤–æ: –û–ø—ã—Ç–Ω—ã–µ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–∏ –≤—Å–µ–≥–¥–∞
                                –≥–æ—Ç–æ–≤—ã –ø–æ–º–æ—á—å –∏ –ø–æ–¥–¥–µ—Ä–∂–∞—Ç—å –Ω–∞ –∫–∞–∂–¥–æ–º —ç—Ç–∞–ø–µ –æ–±—É—á–µ–Ω–∏—è.
                            </li>
                        </ul>
                    </div>
                    {% for theory in theories %}
                        <div id="section{{ forloop.counter }}" class="theory-section" style="display: none;">
                            <h2>{{ theory.title }}</h2>
                            <p>{{ theory.theory | linebreaksbr }}</p>
                        </div>
                        {% for task in theory.tasks.all %}
                          <div id="task_{{ course.id }}_{{ task.id }}" class="task-section" style="display: none;">
                        <h3>{{ task.description }}</h3>
                        <form method="post" action="{% url 'task' %}">
                            {% csrf_token %}
                        </form>
                        </div>
                        {% endfor %}
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
    <script>
document.addEventListener('DOMContentLoaded', function() {
    const theoryLinks = document.querySelectorAll('.sidebar ul li a');
    const theorySections = document.querySelectorAll('.theory-section');
    const taskLinks = document.querySelectorAll('.sidebar ul ul li a');
    const forWhomBlock = document.querySelector('.for-whom');
    const advantagesBlock = document.querySelector('.advantages');
    const descriptionBlock = document.querySelector('.title');
    const mainContent = document.querySelector('.main-content');

    theoryLinks.forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            const targetId = this.getAttribute('href').substr(1);
            const targetSection = document.getElementById(targetId);
            if (targetSection) {
                forWhomBlock.style.display = 'none';
                advantagesBlock.style.display = 'none';
                descriptionBlock.style.display = 'none';

                theorySections.forEach(section => {
                    section.style.display = 'none';
                });
                targetSection.style.display = 'block';
            }
        });
    });

 taskLinks.forEach(link => {
    link.addEventListener('click', function(e) {
        e.preventDefault();
        const taskId = this.getAttribute('href').split('_')[2];
        const taskUrl = "{% url 'task' %}" + `?course_id={{ course.id }}&task_id=${taskId}`;

fetch(taskUrl)
    .then(response => response.text())
    .then(html => {
        // Create a new div to hold the task content
        const taskDiv = document.createElement('div');
        {% comment %} taskDiv.classList.add('container-form'); {% endcomment %}
        taskDiv.innerHTML = html;

        // Append the task content to main content
        mainContent.querySelector('.main').innerHTML = ''; // Clear previous content if needed
        mainContent.querySelector('.main').appendChild(taskDiv);

        // Initialize CodeMirror for the code textarea in the loaded content
        const codeTextarea = taskDiv.querySelector('textarea');
        const languageSelect = taskDiv.querySelector('#language');
        const editor = CodeMirror.fromTextArea(codeTextarea, {
            lineNumbers: true,
            mode: languageSelect.value,
            theme: 'default',
            indentWithTabs: true,
            indentUnit: 4,
        });

        // Reinitialize submit handler for the new form
        const codeForm = taskDiv.querySelector('#codeForm');
            codeForm.addEventListener('submit', function(event) {
            event.preventDefault(); // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –ø–µ—Ä–µ—Ö–æ–¥ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

            const code = editor.getValue();
            const language = languageSelect.value;
            const resultContainer = taskDiv.querySelector('#resultContainer');
            const taskUrl = '{% url "task" %}?task_id=' + taskId;

            fetch(taskUrl, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': '{{ csrf_token }}',
            },
            body: JSON.stringify({
                language: language,
                code: code,
            }),
            })
            .then(response => response.json())
            .then(data => {
            resultContainer.innerHTML = data.message;
            })
            .catch(error => {
            console.error('Error:', error);
            });
        });
    })
    .catch(error => {
        console.error('Error loading task:', error);
    });
    });
});
});
    </script>
</body>
</html>
